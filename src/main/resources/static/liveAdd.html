<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>听会儿中医APP 后台管理系统</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="bower_components/font/ico.css">
	<link rel="Shortcut Icon" href="dist/img/favicon.ico">
	<!-- Ionicons -->
	<link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="dist/css/AdminLTE.min.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
	<link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
	<link rel="stylesheet" href="dist/css/style.css">
	<!-- jQuery 3 -->
	<script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript" src="dist/js/default.js"></script>
	<script type="text/javascript" src="dist/js/sessionStorage.js"></script>
	<script type="text/javascript" src="dist/js/confirm.js"></script>
	<script type="text/javascript" src="dist/js/xlsx.core.min.js"></script>
	<script type="text/javascript" src="dist/js/jquery-sortable.js"></script>
	<script type="text/javascript" src="dist/js/pages/liveAdd.js"></script>


</head>

<body class="hold-transition skin-blue sidebar-mini" data-bar="sidebar_live" data-tag="">
	<!-- Site wrapper -->
	<div class="wrapper">

		<header class="main-header">
		</header>

		<!-- =============================================== -->

		<!-- Left side column. contains the sidebar -->
		<aside class="main-sidebar">
			<!-- sidebar: style can be found in sidebar.less -->
			<section class="sidebar">
			</section>
			<!-- /.sidebar -->
		</aside>

		<!-- =============================================== -->

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<h1>
					直播管理
					<small>添加直播</small>
				</h1>
				<ol class="breadcrumb">
					<li><a href="javascript:void(0);"><i class="fa fa-book"></i> 首页</a></li>
					<li class="active">直播管理</li>
					<li class="active">添加直播</li>
				</ol>
			</section>

			<!-- Main content -->
			<section class="content">
				<div class="row">
					<div class="col-xs-12">
						<div class="box box-primary">
							<div class="box-header">
								<h3 class="box-title"></h3>
							</div>
							<!-- /.box-header -->
							<div class="box-body">
								<form id="zhibo_msg_list" enctype="multipart/form-data" data-id=""
									class="form-horizontal style-form">
									<input type="hidden" name="liveMaster.id" class="live_id" value="">
									<input type="hidden" name="liveMaster.operatorId" class="live_updater" value="">
									<div class="col-md-12 col-lg-12">
										<div class="form-group">
											<label class="col-sm-2 col-md-2 control-label"><span class="text-danger">*
												</span>期数：</label>
											<div class="col-sm-2 col-md-2">
												<input type="number" class="form-control live_number"
													name="liveMaster.liveNumber">
											</div>
											<div class="col-sm-8 col-md-8"></div>
										</div>
										<div class="form-group">
											<label class="col-sm-2 col-md-2 control-label"><span class="text-danger">*
												</span>标题：</label>
											<div class="col-sm-6 col-md-6">
												<input type="text" class="form-control live_title"
													name="liveMaster.liveMasterName">
											</div>
											<div class="col-sm-4 col-md-4"></div>
										</div>
										<div class="form-group">
											<label class="col-sm-2 col-md-2 control-label"><span class="text-danger">*
												</span>副标题：</label>
											<div class="col-sm-6 col-md-6">
												<input type="text" class="form-control live_describe"
													name="liveMaster.liveMasterDescribe">
											</div>
											<div class="col-sm-4 col-md-4"></div>
										</div>
										<div class="form-group hide">
											<label class="col-sm-2 col-md-2 control-label"><span class="text-danger">*
												</span>直播时间：</label>
											<div class="col-sm-6 col-md-6">
												<input type="text" id="live_time" class="form-control live_time_start"
													name="liveMaster.startTime" value="">
											</div>
											<input type="hidden" class="form-control live_time_end"
												name="liveMaster.endTime" value="">
											<div class="col-sm-4 col-md-4"></div>
										</div>
									</div>
									<div class="col-md-12 col-lg-12">
										<input type="hidden" name="courseId" id="courseId" value="" />
										<div class="form-group clear">
											<div class="col-md-12 col-lg-12">
												<div class="col-md-9 col-lg-9">
												</div>
												<div class="col-md-1 col-lg-1 text-right">
													<button type="button" id="excel_file"
														class="btn btn-primary">EXCEL导入</button>
													<div class="hide">
														<input type="file" id="excel-file">
													</div>
												</div>
												<div class="col-md-1 col-lg-1 text-right">
													<a class="btn btn-primary template_download"
														href="files/template.xls" target="_blank">模版下载</a>
												</div>
												<div class="col-md-1 col-lg-1 text-right">
													<button type="button" data-value="0"
														class="btn btn-primary list_clear">清空</button>
												</div>
											</div>
											<div class="col-md-12 col-lg-12 zhibo_msg">
												<ul class="exceltitle">
													<li>
														<div>发言人</div>
														<div>头像</div>
														<div>类型</div>
														<div>内容</div>
														<div>时长</div>
														<div>操作</div>
													</li>
												</ul>
												<ol class="load_table">
												</ol>
											</div>
										</div>
										<div class="hide list_remove">
										</div>
										<div class="form-group text-left clear">
											<div class="col-md-2 col-lg-2">
												<button type="button"
													class="btn btn-primary zhibo_msg_add">增加内容</button>
											</div>
											<div class="col-md-10 col-lg-10"></div>
										</div>
										<div class="form-group text-right clear">
											<div class="col-md-12 col-lg-12">
												<button type="button" id="zhibo_submit"
													class="btn btn-primary zhibo_submit">提交</button>
											</div>
										</div>
									</div>
								</form>
							</div>
							<!-- /.box-body -->
						</div>
						<!-- /.box -->
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->



		<div class="single_msg">
			<div class="mask"></div>
			<div class="single_msg_content box box-primary">
				<div class="box-header with-border">
					<h3 class="box-title slide_add_box_title">添加</h3>
				</div>
				<form id="zhibo_msg_list" enctype="multipart/form-data" class="form-horizontal style-form">
					<div class="box-body">
						<div class="form-group">
							<label class="col-sm-3 col-md-3 control-label">发言人：</label>
							<div class="col-md-9 col-lg-9">
								<input type="text" name="new_msg_speaker" class="new_msg_speaker form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 col-md-3 control-label">头像：</label>
							<div class="col-md-9 col-lg-9">
								<input type="text" name="new_msg_logo" class="new_msg_logo form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 col-md-3 control-label">类型：</label>
							<div class="col-md-9 col-lg-9">
								<input type="radio" name="new_msg_type" class="new_msg_type" value="1"
									checked />文字&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<input type="radio" name="new_msg_type" class="new_msg_type"
									value="2" />音频&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<input type="radio" name="new_msg_type" class="new_msg_type" value="3" />图片
							</div>
						</div>
						<div class="form-group new_msg_file_box">
							<label class="col-sm-3 col-md-3 control-label">文件：</label>
							<div class="col-md-9 col-lg-9">
								<button type="button" class="btn btn-primary new_msg_file"><i
										class="icon-cloud-upload"></i>
									上传文件</button>
							</div>
							<div class="hide">

							</div>
						</div>
						<div class="form-group new_msg_file_box">
							<label class="col-sm-3 col-md-3 control-label">链接：</label>
							<div class="col-md-9 col-lg-9">
								<input type="text" class="new_msg_file_url form-control" name="new_msg_file_url">
							</div>
						</div>
						<div class="form-group new_msg_word_box">
							<label class="col-sm-3 col-md-3 control-label">内容：</label>
							<div class="col-md-9 col-lg-9">
								<textarea class="new_msg_word form-control" wrap="hard" name="new_msg_word"></textarea>
							</div>
						</div>
					</div>
					<div class="box-footer">
						<div class="form-group">
							<div class="col-md-12 col-lg-12 text-right">
								<button type="button"
									class="btn btn-primary new_msg_add">添加</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<button type="button" class="btn btn-default new_msg_cancel">取消</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="single_edit">
			<div class="mask"></div>
			<div class="single_edit_content box box-primary">
				<div class="box-header with-border">
					<h3 class="box-title slide_add_box_title">编辑</h3>
				</div>
				<form id="single_edit_form" enctype="multipart/form-data" class="form-horizontal style-form">
					<div class="box-body">
						<div class="form-group new_edit_file_box">
							<label class="col-sm-3 col-md-3 control-label">文件：</label>
							<div class="col-md-9 col-lg-9">
								<button type="button" class="btn btn-primary edit_msg_file"><i
										class="icon-cloud-upload"></i>
									上传文件</button>
							</div>
						</div>
						<div class="form-group new_edit_file_box">
							<label class="col-sm-3 col-md-3 control-label">链接：</label>
							<div class="col-md-9 col-lg-9">
								<input type="text" class="edit_msg_file_url form-control" name="new_msg_file_url">
							</div>
						</div>
					</div>
					<div class="box-footer">
						<div class="form-group">
							<div class="col-md-12 col-lg-12 text-right">
								<button type="button"
									class="btn btn-primary edit_msg_submit">修改</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<button type="button" class="btn btn-default edit_msg_cancel">取消</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<footer class="main-footer">
		</footer>

		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
			<!-- Create the tabs -->
			<ul class="nav nav-tabs nav-justified control-sidebar-tabs">
			</ul>
			<!-- Tab panes -->
			<div class="tab-content">
				<!-- Home tab content -->
				<div class="tab-pane" id="control-sidebar-home-tab">
				</div>
			</div>
		</aside>
		<!-- /.control-sidebar -->
		<!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
		<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<!-- Bootstrap 3.3.7 -->
	<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<!-- SlimScroll -->
	<script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<!-- FastClick -->
	<script src="bower_components/fastclick/lib/fastclick.js"></script>
	<!-- AdminLTE App -->
	<script src="dist/js/adminlte.min.js"></script>
	<!-- AdminLTE for demo purposes -->
	<script src="dist/js/demo.js"></script>
	<script>
		$(document).ready(function () {
			$('#excel-file').change(function (e) {
				var files = e.target.files;
				var file_name = $(this).val();
				if (file_name != '') {
					var suffix_file = file_name.substr(file_name.lastIndexOf("."));
					//console.log(suffix_file);
					if (suffix_file !== '.xls' && suffix_file !== '.XLS' && suffix_file !== '.xlsx' &&
						suffix_file !==
						'.XLSX' && suffix_file !== '.et' && suffix_file !== '.ET') {
						alert('请上传正确的EXCEL文件(xls、xlsx、et)!');
						return false;
					}
				} else {
					return false;
				}
				var fileReader = new FileReader();
				fileReader.onload = function (ev) {
					try {
						var data = ev.target.result,
							workbook = XLSX.read(data, {
								type: 'binary'
							}), // 以二进制流方式读取得到整份excel表格对象
							persons = []; // 存储获取到的数据
					} catch (e) {
						//console.log('文件类型不正确');
						return;
					}
					var fromTo = '';
					for (var sheet in workbook.Sheets) {
						if (workbook.Sheets.hasOwnProperty(sheet)) {
							fromTo = workbook.Sheets[sheet]['!ref'];
							//console.log(fromTo);
							persons = persons.concat(XLSX.utils.sheet_to_json(workbook.Sheets[sheet]));
							break;
						}
					}
					//$(".load_table").html("");
					var li = "";
					for (var j = 0; j < persons.length; j++) {
						var arr = persons[j];

						var _tmp = '';
						var ii = 0;
						for (var i in arr) {
							ii++
							if (ii == 1) {
								_tmp +=
									'<div class="l_a"><input type="hidden" class="courseId" value="" name=""><input type="text" class="speaker form-control" value="' +
									arr[i] + '" name="name"></div>';
							}
							if (ii == 2) {
								_tmp += '<div class="l_b"><img class="img_prev" src="' + arr[i] + '" /><input type="hidden" class="l_logo_url" value="' + arr[i] + '" name="" ></div>';
							}
							if (ii == 3) {
								_tmp += '<div class="l_c">' + arr[i] + '</div>';
							}
							if (ii == 4) {
								var this_val = arr[i];
								var this_type = '1';
								var point = this_val.lastIndexOf(".");
								var type = this_val.substr(point);
								var number_curr = '';
								//console.log(type);
								if (type == ".jpg" || type == ".gif" || type == ".JPG" || type ==
									".GIF" ||
									type == ".PNG" || type == ".png") {
									this_val = '<img class="img_in_table img_prev" src="' + arr[i] +
										'" />' + '<span class="file_name">' + getFileName1(this_val) +
										'</span>' +
										'<a href="javascript:void(0)" class="url_change"><i class="icon-folder-open"></i></a>';
									this_type = '3';
								} else if (type == ".mp3" || type == ".MP3" || type == ".wav" || type ==
									".WAV" ||
									type == ".WMA" || type == ".wma" || type == ".amr" || type == ".AMR"
								) {
									this_val = '<audio src="' + arr[i] +
										'" class="audio_36" controls="controls">浏览器不支持audio标签</audio>' +
										'<span class="file_name">' + getFileName1(this_val) + '</span>' +
										'<a href="javascript:void(0)" class="url_change"><i class="icon-folder-open"></i></a>';
									this_type = '2';
									number_curr = '0';
								} else {
									this_val = '<p>' + arr[i] + '</p>';
								}
								_tmp += "<div class='l_d' data-type='" + this_type + "'>" + this_val +
									"<div class='hide'><input class='this_value' type='hidden' value='" +
									arr[i] +
									"' name='' /><input class='this_type' type='hidden' value='' name='' /></div></div>";
							}
						}
						li +=
							"<li data-order='' class='excelcontent'>" + _tmp +
							"<div class='l_e'><input class='audio_times form-control' type='number' value='' name='times' /></div>" +
							"<div class='l_f'><button type='button' class='delete btn btn-primary' href='javascript:void(0);'>删除</button></div></li>";
					}
					$(".load_table").append(li);
					$('.load_table').find('audio').each(function () {
						var _li = $(this).parents('li');
						var _audio = $(this).get(0);
						_audio.addEventListener("canplay", function () {
							time = Math.round(_audio.duration);
							if (!isNaN(time)) {
								_li.find('.audio_times').val(time);
							}
						});
					});
				};
				fileReader.readAsBinaryString(files[0]);
			});

			function getFileName1(o) {
				var pos = o.lastIndexOf("/");
				return o.substring(pos + 1);
			}
			$(function () {
				$("ol.load_table").sortable();
			});
		});
	</script>
</body>

</html>